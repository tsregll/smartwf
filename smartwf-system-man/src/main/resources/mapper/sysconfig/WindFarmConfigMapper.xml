<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.smartwf.sm.modules.sysconfig.dao.WindFarmConfigDao" >

    <!-- 批量删除多租户配置 -->
    <delete id="deleteWindFarmConfigByIds" parameterType = "java.util.List">
	    delete 
	       from basic_windfarm_config  
	    where id in
	    <foreach collection="list" item="item" open="(" separator="," close=")">
	        #{item}
	    </foreach>
	</delete>
    
	<!-- 查询风场配置表 -->
    <select id="selectWindFarmConfigByPage" resultType="com.smartwf.sm.modules.sysconfig.vo.WindfarmConfigVO">
        select 
		    a.id as wind_farm,
		    a.org_name as wind_farm_title,
		    a.tenant_id,
			b.id,
			b.kks,
			b.real_time_capacity,
			b.installed_capacity,
			b.daily_generation,
			b.cumulative_generation,
			b.pro_code,
			b.city_code,
			b.area_code,
			b.latitude,
			b.longitude,
			b.geo_json,
			b.generating_set,
			b.power_generation,
			b.stand_by,
			b.malfunctions,
			b.maintenance,
			b.power_restriction,
			b.off_line,
			b.status,
			b.remark,
			b.create_time
		 from sys_organization a left join basic_windfarm_config b on a.id=b.tenant_id
		 where a.enable=0 and a.org_type=1
		 <if test="bean.tenantId != null ">
              and a.tenant_id=#{bean.tenantId}
         </if>
         order by create_time asc
    </select>
    
    
    <!-- 发电量统计 -->
    <select id="selectPortalPowerGenByParam" resultType="com.smartwf.sm.modules.sysconfig.pojo.WindfarmConfig">
         select 
			sum(daily_generation) as daily_generation,
			sum(cumulative_generation) as cumulative_generation,
			sum(real_time_capacity) as real_time_capacity,
			sum(installed_capacity) as installed_capacity
		 from basic_windfarm_config where 1=1
		 <if test="bean.tenantDomain != null ">
              and tenant_domain=#{bean.tenantDomain}
         </if>
         <if test="bean.windFarm != null ">
              and wind_farm=#{bean.windFarm}
         </if>
    </select>
    
    <!-- 门户状态统计 -->
    <select id="selectPortalStatusByParam" resultType="com.smartwf.sm.modules.sysconfig.pojo.WindfarmConfig">
         select 
			sum(generating_set) as generating_set,
			sum(power_generation) as power_generation,
			sum(stand_by) as stand_by,
			sum(malfunctions) as malfunctions,
		    sum(maintenance) as maintenance,
			sum(power_restriction) as power_restriction,
			sum(off_line) as off_line,
		  type
		from basic_windfarm_config where 1=1 
		 <if test="bean.tenantDomain != null ">
              and tenant_domain=#{bean.tenantDomain}
         </if>
         <if test="bean.windFarm != null ">
              and wind_farm=#{bean.windFarm}
         </if>
         group by type order by type asc
    </select>
    
</mapper>